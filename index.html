<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ark Boss Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
            padding: 10px;
            min-height: 100vh;
        }
        
        body.diff-gamma { --diff-color: #4caf50; }
        body.diff-beta { --diff-color: #ff9800; }
        body.diff-alpha { --diff-color: #f44336; }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            position: relative;
        }
        
        h1 {
            font-size: 24px;
            color: #4fc3f7;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .ark-logo {
            width: 60px;
            height: 60px;
            object-fit: contain;
        }
        
        .header-btn {
            position: absolute;
            top: 15px;
            width: 36px;
            height: 36px;
            background: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            color: #888;
        }
        
        .settings-btn {
            right: 15px;
        }
        
        .inventory-btn {
            left: 15px;
        }
        
        .inventory-toggle-header {
            position: absolute;
            left: 60px;
            top: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .toggle-switch-small {
            width: 36px;
            height: 18px;
            background: #333;
            border-radius: 9px;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .toggle-switch-small.active {
            background: #4caf50;
        }
        
        .toggle-switch-small::after {
            content: '';
            position: absolute;
            width: 14px;
            height: 14px;
            background: #888;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.3s ease;
        }
        
        .toggle-switch-small.active::after {
            left: 20px;
            background: #fff;
        }
        
        .inventory-counter {
            position: absolute;
            left: 110px;
            top: 15px;
            background: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 6px;
            padding: 6px 12px;
            font-size: 12px;
            color: #888;
            display: none;
            white-space: nowrap;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .inventory-counter:hover {
            background: #3a3a3a;
            transform: scale(1.05);
        }
        
        .inventory-counter.active {
            display: block;
        }
        
        .inventory-counter.has-items {
            color: #4fc3f7;
            border-color: #4fc3f7;
        }
        
        .header-btn:hover {
            background: #3a3a3a;
            color: #4fc3f7;
        }
        
        .settings-btn:hover {
            transform: rotate(90deg);
        }
        
        .inventory-btn:hover {
            transform: scale(1.1);
        }
        
        .header-btn svg {
            width: 20px;
            height: 20px;
        }
        
        .difficulty-selector {
            margin: 15px 0;
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .diff-btn {
            padding: 10px 20px;
            border: 2px solid #333;
            background: #1a1a1a;
            color: #e0e0e0;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 600;
        }
        
        .diff-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
        }
        
        .diff-btn.gamma { border-color: #4caf50; }
        .diff-btn.beta { border-color: #ff9800; }
        .diff-btn.alpha { border-color: #f44336; }
        .diff-btn.active { color: #000; }
        .diff-btn.gamma.active { background: #4caf50; box-shadow: 0 0 20px rgba(76, 175, 80, 0.5); }
        .diff-btn.beta.active { background: #ff9800; box-shadow: 0 0 20px rgba(255, 152, 0, 0.5); }
        .diff-btn.alpha.active { background: #f44336; box-shadow: 0 0 20px rgba(244, 67, 54, 0.5); }
        
        .status {
            font-size: 12px;
            color: #81c784;
            margin-top: 10px;
        }
        
        .instructions {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 14px;
            line-height: 1.6;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .instructions.collapsed {
            padding: 10px 15px;
        }
        
        .instructions.collapsed .instructions-content {
            display: none;
        }
        
        .instructions-toggle {
            position: absolute;
            top: 15px;
            right: 15px;
            cursor: pointer;
            color: #888;
            transition: all 0.3s ease;
        }
        
        .instructions-toggle:hover {
            color: #4fc3f7;
        }
        
        .instructions-toggle.collapsed {
            transform: rotate(180deg);
        }
        
        .boss-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .boss-card {
            background: #1a1a1a;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            border: 2px solid #2a2a2a;
            transition: all 0.3s ease;
        }
        
        .boss-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
        }
        
        .boss-card.complete {
            border-color: #4caf50;
            background: linear-gradient(135deg, #1a1a1a 0%, #1b3a1b 100%);
        }
        
        .boss-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #4fc3f7;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .boss-icon {
            width: 96px;
            height: 96px;
            margin-right: 10px;
            object-fit: contain;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
        }
        
        .boss-name {
            color: var(--diff-color);
            transition: color 0.3s ease;
        }
		
		
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #333;
            border-radius: 3px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: #4caf50;
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        
        .progress-text {
            font-size: 12px;
            color: #aaa;
            margin-bottom: 5px;
            text-align: center;
        }
        
        .requirements-section {
            margin-bottom: 15px;
        }
        
        .section-title {
            font-size: 14px;
            font-weight: bold;
            color: #ffc107;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .requirement-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            background: #0f0f0f;
            border-radius: 5px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
        }
        
        .requirement-item:hover {
            background: #1f1f1f;
            transform: translateX(2px);
        }
        
        .requirement-item.checked {
            background: #1b5e20;
            text-decoration: line-through;
            opacity: 0.8;
        }
        
        .requirement-item.inventory-locked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .requirement-item.inventory-locked:hover {
            background: #0f0f0f;
            transform: none;
        }
        
        .checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #555;
            border-radius: 4px;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .requirement-item.checked .checkbox {
            background: #4caf50;
            border-color: #4caf50;
        }
        
        .requirement-item.checked .checkbox::after {
            content: '‚úì';
            color: white;
            font-weight: bold;
        }
        
        .requirement-name {
            flex: 1;
            font-size: 14px;
        }
        
        .requirement-quantity {
            font-size: 12px;
            color: #888;
            margin-left: 10px;
            font-weight: bold;
        }
        
        .requirement-item.checked .requirement-quantity {
            color: #666;
        }
        
        .complete-badge {
            background: #4caf50;
            color: #000;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            display: none;
        }
        
        .boss-card.complete .complete-badge {
            display: inline-block;
        }
        
        .inventory-badge {
            background: #4fc3f7;
            color: #000;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 5px;
        }
        
        .inventory-badge.warning {
            background: #ff9800;
        }
        
        .inventory-badge.danger {
            background: #f44336;
            color: #fff;
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal {
            background: #1a1a1a;
            border-radius: 10px;
            padding: 30px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 1px solid #3a3a3a;
            position: relative;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .modal-title {
            font-size: 20px;
            color: #4fc3f7;
            font-weight: bold;
        }
        
        .modal-close {
            width: 32px;
            height: 32px;
            background: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            color: #888;
        }
        
        .modal-close:hover {
            background: #3a3a3a;
            color: #f44336;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid #333;
        }
        
        .tab {
            padding: 10px 20px;
            background: none;
            border: none;
            color: #888;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .tab:hover {
            color: #aaa;
        }
        
        .tab.active {
            color: #4fc3f7;
            border-bottom-color: #4fc3f7;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #aaa;
            font-size: 14px;
            font-weight: 500;
        }
        
        .form-input {
            width: 100%;
            padding: 10px 15px;
            background: #0f0f0f;
            border: 1px solid #333;
            border-radius: 6px;
            color: #e0e0e0;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #4fc3f7;
            background: #1a1a1a;
        }
        
        .form-textarea {
            width: 100%;
            padding: 10px 15px;
            background: #0f0f0f;
            border: 1px solid #333;
            border-radius: 6px;
            color: #e0e0e0;
            font-size: 13px;
            font-family: 'Courier New', monospace;
            min-height: 200px;
            resize: vertical;
            transition: all 0.3s ease;
        }
        
        .form-textarea:focus {
            outline: none;
            border-color: #4fc3f7;
            background: #1a1a1a;
        }
        
        .form-help {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: #4fc3f7;
            color: #000;
            flex: 1;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: #29b6f6;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: #2a2a2a;
            color: #e0e0e0;
            border: 1px solid #3a3a3a;
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: #3a3a3a;
        }
        
        .btn-danger {
            background: #f44336;
            color: #fff;
        }
        
        .btn-danger:hover:not(:disabled) {
            background: #d32f2f;
        }
        
        .sync-status {
            padding: 15px;
            background: #1f1f1f;
            border-radius: 6px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .sync-status.active {
            background: #1b3a1b;
            border: 1px solid #2d5a2d;
        }
        
        .sync-status.inactive {
            background: #3a2a1a;
            border: 1px solid #5a3a2a;
        }
        
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #f44336;
        }
        
        .sync-status.active .status-indicator {
            background: #4caf50;
        }
        
        /* Requirements Editor Styles */
        .req-editor {
            background: #0f0f0f;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .req-editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .req-editor-title {
            font-size: 16px;
            color: #4fc3f7;
            font-weight: 600;
        }
        
        .req-boss-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .req-boss-btn {
            padding: 8px 16px;
            background: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 6px;
            color: #e0e0e0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .req-boss-btn:hover {
            background: #3a3a3a;
        }
        
        .req-boss-btn.active {
            background: #4fc3f7;
            color: #000;
            border-color: #4fc3f7;
        }
        
        .req-diff-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            background: #1a1a1a;
            padding: 5px;
            border-radius: 6px;
        }
        
        .req-diff-tab {
            flex: 1;
            padding: 8px;
            background: none;
            border: none;
            color: #888;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s ease;
            font-size: 13px;
            font-weight: 600;
        }
        
        .req-diff-tab:hover {
            background: #2a2a2a;
        }
        
        .req-diff-tab.active.gamma {
            background: #4caf50;
            color: #000;
        }
        
        .req-diff-tab.active.beta {
            background: #ff9800;
            color: #000;
        }
        
        .req-diff-tab.active.alpha {
            background: #f44336;
            color: #fff;
        }
        
        .req-list {
            margin-bottom: 20px;
        }
        
        .req-list-title {
            font-size: 14px;
            color: #ffc107;
            font-weight: 600;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        
        .req-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #1a1a1a;
            border-radius: 6px;
            margin-bottom: 10px;
        }
        
        .req-item-checkbox {
            width: 20px;
            height: 20px;
        }
        
        .req-item-name {
            flex: 1;
            font-size: 14px;
        }
        
        .req-item-quantity {
            width: 60px;
            padding: 5px 10px;
            background: #0f0f0f;
            border: 1px solid #333;
            border-radius: 4px;
            color: #e0e0e0;
            text-align: center;
            font-size: 14px;
        }
        
        .req-item-quantity:focus {
            outline: none;
            border-color: #4fc3f7;
        }
        
        .req-item-remove {
            padding: 5px 10px;
            background: #3a2a2a;
            border: 1px solid #5a3a2a;
            border-radius: 4px;
            color: #ff9800;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .req-item-remove:hover {
            background: #5a3a2a;
            color: #ffc107;
        }
        
        .req-add-section {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .req-add-input {
            flex: 1;
            padding: 8px 12px;
            background: #0f0f0f;
            border: 1px solid #333;
            border-radius: 6px;
            color: #e0e0e0;
            font-size: 14px;
        }
        
        .req-add-btn {
            padding: 8px 16px;
            background: #4caf50;
            border: none;
            border-radius: 6px;
            color: #000;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .req-add-btn:hover {
            background: #45a049;
        }
        
        /* Inventory Modal Styles */
        .inventory-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: #0f0f0f;
            border-radius: 6px;
            margin-bottom: 10px;
        }
        
        .inventory-item-name {
            flex: 1;
            font-size: 14px;
        }
        
        .inventory-item-quantity {
            width: 80px;
            padding: 5px 10px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 4px;
            color: #e0e0e0;
            text-align: center;
            font-size: 14px;
        }
        
        .inventory-item-quantity:focus {
            outline: none;
            border-color: #4fc3f7;
        }
        
        .inventory-summary {
            margin-top: 20px;
            padding: 15px;
            background: #0f0f0f;
            border-radius: 8px;
        }
        
        .inventory-summary-title {
            font-size: 16px;
            color: #4fc3f7;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .inventory-summary-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            font-size: 14px;
        }
        
        .inventory-summary-item.low {
            color: #ff9800;
        }
        
        .inventory-summary-item.out {
            color: #f44336;
        }
        
        .tribe-notice {
            background: #4a3a1a;
            border: 1px solid #6a5a3a;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .tribe-notice strong {
            color: #ffc107;
        }
        
        @media (max-width: 768px) {
            h1 { font-size: 20px; }
            .boss-grid { grid-template-columns: 1fr; }
            .diff-btn { padding: 8px 15px; font-size: 13px; }
            .boss-title { font-size: 18px; }
            .boss-icon { width: 24px; height: 24px; }
            .modal { max-height: 95vh; max-width: 90%; padding: 20px; }
            .req-boss-selector { flex-wrap: wrap; }
            .req-boss-btn { font-size: 12px; padding: 6px 12px; }
            .header-btn { width: 32px; height: 32px; }
            .header-btn svg { width: 18px; height: 18px; }
            .inventory-badge { font-size: 10px; padding: 2px 6px; }
            .inventory-counter { 
                left: 95px; 
                font-size: 11px; 
                padding: 4px 8px;
            }
            .inventory-toggle-header {
                left: 50px;
            }
        }
    </style>
</head>
<body class="diff-gamma">
    <div class="header">
        <button class="header-btn inventory-btn" id="inventoryBtn" title="Inventory">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="3" y1="9" x2="21" y2="9"></line>
                <line x1="9" y1="21" x2="9" y2="9"></line>
            </svg>
        </button>
        <div class="inventory-toggle-header" title="Show inventory counts on requirements">
            <div class="toggle-switch-small" id="inventorySwitch"></div>
        </div>
        <div class="inventory-counter" id="inventoryCounter">
            <span id="inventoryCountText">0 items</span>
        </div>
        <h1>
            <img src="ark-wiki.webp" alt="Ark" class="ark-logo" onerror="this.style.display='none'">
            Ark Survival Ascended - Boss Tracker
        </h1>
        <button class="header-btn settings-btn" id="settingsBtn" title="Settings">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1"></path>
                <path d="M20.5 7.5L16 12l4.5 4.5M3.5 7.5L8 12l-4.5 4.5"></path>
                <path d="M20.5 16.5L16 12l4.5-4.5M3.5 16.5L8 12l-4.5-4.5"></path>
            </svg>
        </button>
        <div class="difficulty-selector">
            <button class="diff-btn gamma active" data-diff="gamma">GAMMA</button>
            <button class="diff-btn beta" data-diff="beta">BETA</button>
            <button class="diff-btn alpha" data-diff="alpha">ALPHA</button>
        </div>
        <div class="status" id="status">Connecting...</div>
    </div>
    
    <div class="tribe-notice" id="tribeNotice" style="display: none;">
        <strong>‚ö†Ô∏è No Tribe Set!</strong> 
        Go to Settings ‚Üí Enter a Tribe Name to enable Firebase sync
    </div>
    
    <div class="instructions" id="instructions">
        <div class="instructions-toggle" id="instructionsToggle">
            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
        </div>
        <div class="instructions-content">
            <strong>Instructions:</strong> Select difficulty, then click items to mark as collected. Progress saves automatically!
        </div>
    </div>
    
    <div class="boss-grid" id="bossGrid">
        <!-- Boss cards will be generated here -->
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">‚öôÔ∏è Settings</h2>
                <button class="modal-close" id="modalClose">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            
            <div class="tabs">
                <button class="tab active" data-tab="general">General</button>
                <button class="tab" data-tab="requirements">Requirements</button>
            </div>
            
            <div class="tab-content active" id="generalTab">
                <div class="sync-status inactive" id="syncStatus">
                    <div class="status-indicator"></div>
                    <div>
                        <strong>Sync Status:</strong> <span id="syncStatusText">Local Mode Only</span>
                    </div>
                </div>
                
                <form id="settingsForm">
                    <div class="form-group">
                        <label class="form-label" for="tribeName">Tribe Name (Required for sync)</label>
                        <input type="text" class="form-input" id="tribeName" placeholder="Enter your tribe name...">
                        <div class="form-help">This is required to enable Firebase sync with your tribe members</div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelBtn">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save & Apply</button>
                    </div>
                </form>
            </div>
            
            <div class="tab-content" id="requirementsTab">
                <div class="req-editor">
                    <div class="req-editor-header">
                        <h3 class="req-editor-title">Edit Boss Requirements</h3>
                        <button class="btn btn-danger" id="resetAllReqs">Reset All to Default</button>
                    </div>
                    
                    <div class="req-boss-selector">
                        <button class="req-boss-btn active" data-boss="broodmother">Broodmother</button>
                        <button class="req-boss-btn" data-boss="megapithecus">Megapithecus</button>
                        <button class="req-boss-btn" data-boss="dragon">Dragon</button>
                        <button class="req-boss-btn" data-boss="overseer">Overseer</button>
                    </div>
                    
                    <div class="req-diff-tabs">
                        <button class="req-diff-tab gamma active" data-diff="gamma">Gamma</button>
                        <button class="req-diff-tab beta" data-diff="beta">Beta</button>
                        <button class="req-diff-tab alpha" data-diff="alpha">Alpha</button>
                    </div>
                    
                    <div id="reqEditorContent">
                        <!-- Requirements will be loaded here -->
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelReqBtn">Cancel</button>
                        <button type="button" class="btn btn-primary" id="saveReqBtn">Save Requirements</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Inventory Modal -->
    <div class="modal-overlay" id="inventoryModalOverlay">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">üì¶ Inventory Management</h2>
                <button class="modal-close" id="inventoryModalClose">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            
            <div class="tabs">
                <button class="tab active" data-tab="artifacts-inv">Artifacts</button>
                <button class="tab" data-tab="tributes-inv">Tributes</button>
                <button class="tab" data-tab="trophies-inv">Boss Trophies</button>
                <button class="tab" data-tab="summary-inv">Summary</button>
            </div>
            
            <div class="tab-content active" id="artifacts-invTab">
                <div class="form-help" style="margin-bottom: 15px;">
                    Enter the quantity of each artifact you have in storage.
                </div>
                <div id="artifactsInventoryList">
                    <!-- Artifacts will be populated here -->
                </div>
            </div>
            
            <div class="tab-content" id="tributes-invTab">
                <div class="form-help" style="margin-bottom: 15px;">
                    Enter the quantity of each tribute you have in storage.
                </div>
                <div id="tributesInventoryList">
                    <!-- Tributes will be populated here -->
                </div>
            </div>
            
            <div class="tab-content" id="trophies-invTab">
                <div class="form-help" style="margin-bottom: 15px;">
                    Enter the quantity of boss trophies you have in storage.
                </div>
                <div id="trophiesInventoryList">
                    <!-- Trophies will be populated here -->
                </div>
            </div>
            
            <div class="tab-content" id="summary-invTab">
                <div class="inventory-summary">
                    <div class="inventory-summary-title">Inventory Overview</div>
                    <div id="inventorySummaryContent">
                        <!-- Summary will be populated here -->
                    </div>
                </div>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" id="inventoryCancelBtn">Close</button>
                <button type="button" class="btn btn-primary" id="inventorySaveBtn">Save Inventory</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize on DOM load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Ark Boss Tracker initializing...');
            
            // App state - with proper initialization
            const app = {
                currentDifficulty: 'gamma',
                currentBoss: 'broodmother',
                currentEditDiff: 'gamma',
                useFirebase: false,
                database: null,
                dataRef: null,
                inventoryRef: null,
                checkedItems: {},
                editingRequirements: null,
                // Properly initialize inventory
                inventory: {
                    artifacts: {},
                    tributes: {},
                    bossTrophies: {}
                },
                showInventory: false,
                
                // Default boss requirements
                defaultRequirements: {
                    gamma: {
                        broodmother: {
                            icon: 'ark-wiki-broodmother.webp',
                            artifacts: ['hunter', 'clever', 'pack'],
                            tributes: {
                                'argentavis-talon': 1,
                                'sauropod-vertebra': 1,
                                'titanoboa-venom': 1
                            }
                        },
                        megapithecus: {
                            icon: 'ark-wiki-megapithecus.webp',
                            artifacts: ['brute', 'devourer', 'pack'],
                            tributes: {
                                'megalania-toxin': 1,
                                'megalodon-tooth': 1,
                                'spinosaurus-sail': 1
                            }
                        },
                        dragon: {
                            icon: 'ark-wiki-dragon.webp',
                            artifacts: ['cunning', 'immune', 'skylord', 'strong'],
                            tributes: {
                                'allosaurus-brain': 1,
                                'basilosaurus-blubber': 1,
                                'giganotosaurus-heart': 1,
                                'tusoteuthis-tentacle': 1
                            }
                        },
                        overseer: {
                            icon: 'ark-wiki-overseer.webp',
                            artifacts: [],
                            tributes: {},
                            bossTrophies: ['broodmother-gamma', 'megapithecus-gamma', 'dragon-gamma']
                        }
                    },
                    beta: {
                        broodmother: {
                            icon: 'ark-wiki-broodmother.webp',
                            artifacts: ['hunter', 'clever', 'pack', 'massive', 'devious'],
                            tributes: {
                                'argentavis-talon': 5,
                                'sauropod-vertebra': 5,
                                'titanoboa-venom': 5,
                                'thylacoleo-hook-claw': 5
                            }
                        },
                        megapithecus: {
                            icon: 'ark-wiki-megapithecus.webp',
                            artifacts: ['brute', 'devourer', 'pack', 'cunning', 'immune'],
                            tributes: {
                                'megalania-toxin': 5,
                                'megalodon-tooth': 5,
                                'spinosaurus-sail': 5,
                                'therizino-claws': 5
                            }
                        },
                        dragon: {
                            icon: 'ark-wiki-dragon.webp',
                            artifacts: ['cunning', 'immune', 'skylord', 'strong', 'devious', 'hunter'],
                            tributes: {
                                'allosaurus-brain': 5,
                                'basilosaurus-blubber': 5,
                                'giganotosaurus-heart': 1,
                                'tusoteuthis-tentacle': 5,
                                'tyrannosaurus-arm': 5,
                                'yutyrannus-lungs': 5
                            }
                        },
                        overseer: {
                            icon: 'ark-wiki-overseer.webp',
                            artifacts: [],
                            tributes: {},
                            bossTrophies: ['broodmother-beta', 'megapithecus-beta', 'dragon-beta']
                        }
                    },
                    alpha: {
                        broodmother: {
                            icon: 'ark-wiki-broodmother.webp',
                            artifacts: ['hunter', 'clever', 'pack', 'massive', 'devious', 'strong', 'immune', 'skylord'],
                            tributes: {
                                'argentavis-talon': 10,
                                'sauropod-vertebra': 10,
                                'titanoboa-venom': 10,
                                'thylacoleo-hook-claw': 10,
                                'megalania-toxin': 10
                            }
                        },
                        megapithecus: {
                            icon: 'ark-wiki-megapithecus.webp',
                            artifacts: ['brute', 'devourer', 'pack', 'cunning', 'immune', 'strong', 'massive', 'clever'],
                            tributes: {
                                'megalania-toxin': 10,
                                'megalodon-tooth': 10,
                                'spinosaurus-sail': 10,
                                'therizino-claws': 10,
                                'thylacoleo-hook-claw': 10
                            }
                        },
                        dragon: {
                            icon: 'ark-wiki-dragon.webp',
                            artifacts: ['cunning', 'immune', 'skylord', 'strong', 'devious', 'hunter', 'massive', 'clever'],
                            tributes: {
                                'allosaurus-brain': 10,
                                'basilosaurus-blubber': 10,
                                'giganotosaurus-heart': 2,
                                'tusoteuthis-tentacle': 10,
                                'tyrannosaurus-arm': 15,
                                'yutyrannus-lungs': 10
                            }
                        },
                        overseer: {
                            icon: 'ark-wiki-overseer.webp',
                            artifacts: [],
                            tributes: {},
                            bossTrophies: ['broodmother-alpha', 'megapithecus-alpha', 'dragon-alpha']
                        }
                    }
                },
                
                // Item names for display
                itemNames: {
                    artifacts: {
                        'hunter': 'Artifact of the Hunter',
                        'clever': 'Artifact of the Clever',
                        'pack': 'Artifact of the Pack',
                        'massive': 'Artifact of the Massive',
                        'devious': 'Artifact of the Devious',
                        'immune': 'Artifact of the Immune',
                        'strong': 'Artifact of the Strong',
                        'cunning': 'Artifact of the Cunning',
                        'skylord': 'Artifact of the Skylord',
                        'devourer': 'Artifact of the Devourer',
                        'brute': 'Artifact of the Brute'
                    },
                    tributes: {
                        'argentavis-talon': 'Argentavis Talon',
                        'sauropod-vertebra': 'Sauropod Vertebra',
                        'titanoboa-venom': 'Titanoboa Venom',
                        'megalania-toxin': 'Megalania Toxin',
                        'megalodon-tooth': 'Megalodon Tooth',
                        'spinosaurus-sail': 'Spinosaurus Sail',
                        'therizino-claws': 'Therizino Claws',
                        'thylacoleo-hook-claw': 'Thylacoleo Hook-Claw',
                        'allosaurus-brain': 'Allosaurus Brain',
                        'basilosaurus-blubber': 'Basilosaurus Blubber',
                        'giganotosaurus-heart': 'Giganotosaurus Heart',
                        'tusoteuthis-tentacle': 'Tusoteuthis Tentacle',
                        'tyrannosaurus-arm': 'Tyrannosaurus Arm',
                        'yutyrannus-lungs': 'Yutyrannus Lungs'
                    },
                    bossTrophies: {
                        'broodmother-gamma': 'Broodmother Trophy (Gamma)',
                        'broodmother-beta': 'Broodmother Trophy (Beta)',
                        'broodmother-alpha': 'Broodmother Trophy (Alpha)',
                        'megapithecus-gamma': 'Megapithecus Trophy (Gamma)',
                        'megapithecus-beta': 'Megapithecus Trophy (Beta)',
                        'megapithecus-alpha': 'Megapithecus Trophy (Alpha)',
                        'dragon-gamma': 'Dragon Trophy (Gamma)',
                        'dragon-beta': 'Dragon Trophy (Beta)',
                        'dragon-alpha': 'Dragon Trophy (Alpha)'
                    }
                },
                
                bossEmojis: {
                    'broodmother': 'üï∑Ô∏è',
                    'megapithecus': 'ü¶ç',
                    'dragon': 'üê≤',
                    'overseer': 'ü§ñ'
                },
				
				bossNames: {
                    'broodmother': 'Broodmother',
                    'megapithecus': 'Megapithecus',
                    'dragon': 'Dragon',
                    'overseer': 'Overseer'
                }
            };
            
            // Copy default requirements to current
            app.bossRequirements = JSON.parse(JSON.stringify(app.defaultRequirements));
            
            // Load saved requirements
            const savedSettings = localStorage.getItem('arkTrackerSettings');
            if (savedSettings) {
                try {
                    const settings = JSON.parse(savedSettings);
                    if (settings.customRequirements) {
                        app.bossRequirements = settings.customRequirements;
                    }
                    if (settings.showInventory !== undefined) {
                        app.showInventory = settings.showInventory;
                        document.getElementById('inventorySwitch').classList.toggle('active', app.showInventory);
                        document.getElementById('inventoryCounter').classList.toggle('active', app.showInventory);
                    }
                    // Check for tribe name
                    if (!settings.tribeName) {
                        document.getElementById('tribeNotice').style.display = 'block';
                    }
                } catch (error) {
                    console.error('Error loading saved settings:', error);
                }
            } else {
                // No settings saved - show tribe notice
                document.getElementById('tribeNotice').style.display = 'block';
            }
            
            // Load saved inventory with proper initialization
            const savedInventory = localStorage.getItem('arkInventory');
            if (savedInventory) {
                try {
                    const parsed = JSON.parse(savedInventory);
                    app.inventory = {
                        artifacts: parsed.artifacts || {},
                        tributes: parsed.tributes || {},
                        bossTrophies: parsed.bossTrophies || {}
                    };
                } catch (error) {
                    console.error('Error loading saved inventory:', error);
                    // Reset to empty inventory
                    app.inventory = {
                        artifacts: {},
                        tributes: {},
                        bossTrophies: {}
                    };
                }
            }
            
            // Initialize Firebase config - YOUR CONFIG
            const firebaseConfig = {
                apiKey: "AIzaSyAjRf1Fy8wmUhpVkCH7HFafQ-45DAfYpLQ",
                authDomain: "arkbosses-7ee8d.firebaseapp.com",
                databaseURL: "https://arkbosses-7ee8d-default-rtdb.firebaseio.com",
                projectId: "arkbosses-7ee8d",
                storageBucket: "arkbosses-7ee8d.firebasestorage.app",
                messagingSenderId: "902367347707",
                appId: "1:902367347707:web:fab546c35ef5d72523815e"
            };
            
            // Main initialization
            function init() {
                setupEventListeners();
                
                // Always try to use Firebase with your config
                app.useFirebase = true;
                loadFirebase();
            }
            
            // Load Firebase scripts
            function loadFirebase() {
                const script1 = document.createElement('script');
                script1.src = 'https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js';
                document.head.appendChild(script1);
                
                script1.onload = () => {
                    const script2 = document.createElement('script');
                    script2.src = 'https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js';
                    document.head.appendChild(script2);
                    
                    script2.onload = () => {
                        try {
                            firebase.initializeApp(firebaseConfig);
                            app.database = firebase.database();
                            
                            const settings = JSON.parse(localStorage.getItem('arkTrackerSettings') || '{}');
                            
                            if (settings.tribeName) {
                                // Hide tribe notice if tribe is set
                                document.getElementById('tribeNotice').style.display = 'none';
                                
                                // Create the base tribe path
                                const baseTribePath = `tribes/${settings.tribeName.replace(/[.#$\[\]]/g, '_')}`;
                                
                                // Boss tracker reference
                                app.dataRef = app.database.ref(`${baseTribePath}/bossTracker`);
                                app.dataRef.on('value', (snapshot) => {
                                    app.checkedItems = snapshot.val() || {};
                                    renderBosses();
                                    updateStatus('üü¢ Connected - Real-time sync active', '#81c784');
                                }, (error) => {
                                    console.error('Boss tracker sync error:', error);
                                    updateStatus('‚ö†Ô∏è Sync error - Check connection', '#ff9800');
                                });
                                
                                // Inventory reference
                                app.inventoryRef = app.database.ref(`${baseTribePath}/inventory`);
                                console.log('Inventory path:', `${baseTribePath}/inventory`);
                                
                                app.inventoryRef.on('value', (snapshot) => {
                                    const data = snapshot.val();
                                    console.log('Inventory data from Firebase:', data);
                                    if (data) {
                                        app.inventory = {
                                            artifacts: data.artifacts || {},
                                            tributes: data.tributes || {},
                                            bossTrophies: data.bossTrophies || {}
                                        };
                                        updateInventoryCounter();
                                        // Update UI if inventory modal is open
                                        if (document.getElementById('inventoryModalOverlay').classList.contains('active')) {
                                            loadInventoryModal();
                                        }
                                    }
                                }, (error) => {
                                    console.error('Inventory sync error:', error);
                                });
                            } else {
                                // No tribe name set
                                console.log('No tribe name set - Firebase sync disabled');
                                updateStatus('‚ö†Ô∏è Set tribe name in Settings for sync', '#ff9800');
                                initializeApp();
                            }
                            
                        } catch (error) {
                            console.error('Firebase initialization error:', error);
                            app.useFirebase = false;
                            initializeApp();
                        }
                    };
                };
                
                script1.onerror = () => {
                    console.error('Failed to load Firebase');
                    app.useFirebase = false;
                    initializeApp();
                };
            }
            
            // Initialize app
            function initializeApp() {
                if (!app.useFirebase) {
                    loadLocalData();
                }
                renderBosses();
                updateInventoryCounter();
            }
            
            // Load local data
            function loadLocalData() {
                updateStatus('üü° Local mode - No sync', '#ffc107');
                const savedData = localStorage.getItem('arkBossTracker');
                if (savedData) {
                    app.checkedItems = JSON.parse(savedData);
                }
            }
            
            // Update status
            function updateStatus(text, color) {
                const status = document.getElementById('status');
                status.textContent = text;
                status.style.color = color;
            }
            
            // Setup event listeners
            function setupEventListeners() {
                // Difficulty selector
                document.querySelectorAll('.diff-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        app.currentDifficulty = e.target.getAttribute('data-diff');
                        document.body.className = `diff-${app.currentDifficulty}`;
                        renderBosses();
                    });
                });
                
                // Settings modal
                document.getElementById('settingsBtn').addEventListener('click', () => {
                    document.getElementById('modalOverlay').classList.add('active');
                    loadSettings();
                });
                
                document.getElementById('modalClose').addEventListener('click', () => {
                    document.getElementById('modalOverlay').classList.remove('active');
                });
                
                document.getElementById('modalOverlay').addEventListener('click', (e) => {
                    if (e.target.id === 'modalOverlay') {
                        document.getElementById('modalOverlay').classList.remove('active');
                    }
                });
                
                // Tabs
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const tabName = e.target.getAttribute('data-tab');
                        const isInventoryModal = e.target.closest('#inventoryModalOverlay');
                        const modalPrefix = isInventoryModal ? '#inventoryModalOverlay ' : '';
                        
                        document.querySelectorAll(modalPrefix + '.tab').forEach(t => t.classList.remove('active'));
                        document.querySelectorAll(modalPrefix + '.tab-content').forEach(c => c.classList.remove('active'));
                        e.target.classList.add('active');
                        document.getElementById(`${tabName}Tab`).classList.add('active');
                        
                        if (tabName === 'requirements') {
                            loadRequirementsEditor();
                        } else if (tabName === 'summary-inv') {
                            updateInventorySummary();
                        }
                    });
                });
                
                // Settings form
                document.getElementById('settingsForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    saveSettings();
                });
                
                document.getElementById('cancelBtn').addEventListener('click', () => {
                    document.getElementById('modalOverlay').classList.remove('active');
                });
                
                // Requirements editor
                document.querySelectorAll('.req-boss-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.req-boss-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        app.currentBoss = e.target.getAttribute('data-boss');
                        loadRequirementsForBoss();
                    });
                });
                
                document.querySelectorAll('.req-diff-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        document.querySelectorAll('.req-diff-tab').forEach(t => t.classList.remove('active'));
                        e.target.classList.add('active');
                        app.currentEditDiff = e.target.getAttribute('data-diff');
                        e.target.classList.add(app.currentEditDiff);
                        loadRequirementsForBoss();
                    });
                });
                
                document.getElementById('resetAllReqs').addEventListener('click', () => {
                    if (confirm('Reset ALL boss requirements to default values? This cannot be undone.')) {
                        app.editingRequirements = JSON.parse(JSON.stringify(app.defaultRequirements));
                        loadRequirementsForBoss();
                    }
                });
                
                document.getElementById('saveReqBtn').addEventListener('click', saveRequirements);
                document.getElementById('cancelReqBtn').addEventListener('click', () => {
                    document.getElementById('modalOverlay').classList.remove('active');
                });
                
                // Instructions toggle
                document.getElementById('instructionsToggle').addEventListener('click', () => {
                    const instructions = document.getElementById('instructions');
                    const toggle = document.getElementById('instructionsToggle');
                    instructions.classList.toggle('collapsed');
                    toggle.classList.toggle('collapsed');
                });
                
                // Inventory modal
                document.getElementById('inventoryBtn').addEventListener('click', () => {
                    document.getElementById('inventoryModalOverlay').classList.add('active');
                    loadInventoryModal();
                });
                
                // Inventory counter click
                document.getElementById('inventoryCounter').addEventListener('click', () => {
                    document.getElementById('inventoryModalOverlay').classList.add('active');
                    loadInventoryModal();
                });
                
                document.getElementById('inventoryModalClose').addEventListener('click', () => {
                    document.getElementById('inventoryModalOverlay').classList.remove('active');
                });
                
                document.getElementById('inventoryModalOverlay').addEventListener('click', (e) => {
                    if (e.target.id === 'inventoryModalOverlay') {
                        document.getElementById('inventoryModalOverlay').classList.remove('active');
                    }
                });
                
                document.getElementById('inventoryCancelBtn').addEventListener('click', () => {
                    document.getElementById('inventoryModalOverlay').classList.remove('active');
                });
                
                document.getElementById('inventorySaveBtn').addEventListener('click', saveInventory);
                
                // Inventory toggle
                document.getElementById('inventorySwitch').addEventListener('click', () => {
                    app.showInventory = !app.showInventory;
                    document.getElementById('inventorySwitch').classList.toggle('active', app.showInventory);
                    document.getElementById('inventoryCounter').classList.toggle('active', app.showInventory);
                    
                    const settings = JSON.parse(localStorage.getItem('arkTrackerSettings') || '{}');
                    settings.showInventory = app.showInventory;
                    localStorage.setItem('arkTrackerSettings', JSON.stringify(settings));
                    
                    updateInventoryCounter();
                    renderBosses();
                });
                
                // Update inventory counter on page load
                updateInventoryCounter();
            }
            
            // Update inventory counter
            function updateInventoryCounter() {
                const artifactCount = Object.values(app.inventory.artifacts || {}).reduce((sum, qty) => sum + (parseInt(qty) || 0), 0);
                const tributeCount = Object.values(app.inventory.tributes || {}).reduce((sum, qty) => sum + (parseInt(qty) || 0), 0);
                const trophyCount = Object.values(app.inventory.bossTrophies || {}).reduce((sum, qty) => sum + (parseInt(qty) || 0), 0);
                const totalCount = artifactCount + tributeCount + trophyCount;
                
                const counterText = document.getElementById('inventoryCountText');
                const counter = document.getElementById('inventoryCounter');
                
                if (totalCount === 0) {
                    counterText.textContent = 'No items';
                } else {
                    const parts = [];
                    if (artifactCount > 0) parts.push(`${artifactCount}A`);
                    if (tributeCount > 0) parts.push(`${tributeCount}T`);
                    if (trophyCount > 0) parts.push(`${trophyCount}B`);
                    counterText.textContent = parts.join(' ‚Ä¢ ');
                }
                
                counter.classList.toggle('has-items', totalCount > 0);
                counter.title = `Artifacts: ${artifactCount}\nTributes: ${tributeCount}\nBoss Trophies: ${trophyCount}\nTotal: ${totalCount}`;
            }
            
            // Calculate distributed items
            function calculateDistributedItems() {
                const distributed = {
                    artifacts: {},
                    tributes: {},
                    bossTrophies: {}
                };
                
                // Count items marked as collected across all difficulties and bosses
                Object.entries(app.checkedItems).forEach(([key, value]) => {
                    if (!value) return;
                    
                    const parts = key.split('-');
                    const difficulty = parts[0];
                    const bossId = parts[1];
                    const type = parts[2];
                    const itemId = parts.slice(3).join('-');
                    
                    if (type === 'artifact') {
                        if (!distributed.artifacts[itemId]) {
                            distributed.artifacts[itemId] = 0;
                        }
                        distributed.artifacts[itemId] += 1;
                    } else if (type === 'tribute') {
                        if (!distributed.tributes[itemId]) {
                            distributed.tributes[itemId] = 0;
                        }
                        // Add the required quantity for this boss/difficulty
                        const bossData = app.bossRequirements[difficulty] && app.bossRequirements[difficulty][bossId];
                        if (bossData && bossData.tributes && bossData.tributes[itemId]) {
                            distributed.tributes[itemId] += bossData.tributes[itemId];
                        }
                    } else if (type === 'trophy') {
                        if (!distributed.bossTrophies[itemId]) {
                            distributed.bossTrophies[itemId] = 0;
                        }
                        distributed.bossTrophies[itemId] += 1;
                    }
                });
                
                return distributed;
            }
            
            // Load settings
            function loadSettings() {
                const savedSettings = localStorage.getItem('arkTrackerSettings');
                if (savedSettings) {
                    const settings = JSON.parse(savedSettings);
                    document.getElementById('tribeName').value = settings.tribeName || '';
                }
                
                const syncStatus = document.getElementById('syncStatus');
                const syncStatusText = document.getElementById('syncStatusText');
                
                const settings = JSON.parse(localStorage.getItem('arkTrackerSettings') || '{}');
                if (app.useFirebase && settings.tribeName) {
                    syncStatus.className = 'sync-status active';
                    syncStatusText.textContent = 'Connected to Firebase';
                } else {
                    syncStatus.className = 'sync-status inactive';
                    syncStatusText.textContent = settings.tribeName ? 'Connecting...' : 'No Tribe Name Set';
                }
            }
            
            // Save settings
            function saveSettings() {
                const tribeName = document.getElementById('tribeName').value.trim();
                
                if (!tribeName) {
                    alert('Please enter a tribe name to enable sync!');
                    return;
                }
                
                const settings = JSON.parse(localStorage.getItem('arkTrackerSettings') || '{}');
                settings.tribeName = tribeName;
                settings.customRequirements = app.bossRequirements;
                settings.showInventory = app.showInventory;
                
                localStorage.setItem('arkTrackerSettings', JSON.stringify(settings));
                
                alert('Settings saved! The page will reload to apply changes.');
                location.reload();
            }
            
            // Load requirements editor
            function loadRequirementsEditor() {
                app.editingRequirements = JSON.parse(JSON.stringify(app.bossRequirements));
                loadRequirementsForBoss();
            }
            
            // Load requirements for selected boss
            function loadRequirementsForBoss() {
                const container = document.getElementById('reqEditorContent');
                container.innerHTML = '';
                
                const bossData = app.editingRequirements[app.currentEditDiff][app.currentBoss];
                
                // Artifacts section
                if (app.currentBoss !== 'overseer' || app.currentEditDiff === 'gamma') {
                    const artifactsSection = createRequirementsSection('Artifacts', 'artifacts', bossData.artifacts || []);
                    container.appendChild(artifactsSection);
                }
                
                // Tributes section
                if (app.currentBoss !== 'overseer') {
                    const tributesSection = createRequirementsSection('Tributes', 'tributes', bossData.tributes || {});
                    container.appendChild(tributesSection);
                }
                
                // Boss Trophies section (Overseer only)
                if (app.currentBoss === 'overseer') {
                    const trophiesSection = createRequirementsSection('Boss Trophies', 'bossTrophies', bossData.bossTrophies || []);
                    container.appendChild(trophiesSection);
                }
            }
            
            // Create requirements section
            function createRequirementsSection(title, type, items) {
                const section = document.createElement('div');
                section.className = 'req-list';
                
                const titleEl = document.createElement('div');
                titleEl.className = 'req-list-title';
                titleEl.textContent = title;
                section.appendChild(titleEl);
                
                const itemsContainer = document.createElement('div');
                itemsContainer.id = `${type}Container`;
                
                if (type === 'tributes') {
                    Object.entries(items).forEach(([id, quantity]) => {
                        const item = createTributeItem(id, quantity);
                        itemsContainer.appendChild(item);
                    });
                } else {
                    items.forEach(id => {
                        const item = createArtifactItem(type, id);
                        itemsContainer.appendChild(item);
                    });
                }
                
                section.appendChild(itemsContainer);
                
                // Add new item section
                const addSection = document.createElement('div');
                addSection.className = 'req-add-section';
                
                const addInput = document.createElement('input');
                addInput.className = 'req-add-input';
                addInput.placeholder = `Add new ${title.slice(0, -1).toLowerCase()}...`;
                addInput.id = `${type}AddInput`;
                
                const addBtn = document.createElement('button');
                addBtn.className = 'req-add-btn';
                addBtn.textContent = 'Add';
                addBtn.onclick = () => addNewItem(type);
                
                addSection.appendChild(addInput);
                addSection.appendChild(addBtn);
                section.appendChild(addSection);
                
                return section;
            }
            
            // Create artifact/trophy item
            function createArtifactItem(type, id) {
                const item = document.createElement('div');
                item.className = 'req-item';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'req-item-checkbox';
                checkbox.checked = true;
                checkbox.onchange = (e) => toggleItem(type, id, e.target.checked);
                
                const name = document.createElement('div');
                name.className = 'req-item-name';
                name.textContent = app.itemNames[type][id] || id;
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'req-item-remove';
                removeBtn.textContent = 'Remove';
                removeBtn.onclick = () => removeItem(type, id);
                
                item.appendChild(checkbox);
                item.appendChild(name);
                item.appendChild(removeBtn);
                
                return item;
            }
            
            // Create tribute item
            function createTributeItem(id, quantity) {
                const item = document.createElement('div');
                item.className = 'req-item';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'req-item-checkbox';
                checkbox.checked = true;
                checkbox.onchange = (e) => toggleItem('tributes', id, e.target.checked);
                
                const name = document.createElement('div');
                name.className = 'req-item-name';
                name.textContent = app.itemNames.tributes[id] || id;
                
                const quantityInput = document.createElement('input');
                quantityInput.type = 'number';
                quantityInput.className = 'req-item-quantity';
                quantityInput.value = quantity;
                quantityInput.min = 1;
                quantityInput.onchange = (e) => updateQuantity(id, parseInt(e.target.value));
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'req-item-remove';
                removeBtn.textContent = 'Remove';
                removeBtn.onclick = () => removeItem('tributes', id);
                
                item.appendChild(checkbox);
                item.appendChild(name);
                item.appendChild(quantityInput);
                item.appendChild(removeBtn);
                
                return item;
            }
            
            // Toggle item
            function toggleItem(type, id, checked) {
                const bossData = app.editingRequirements[app.currentEditDiff][app.currentBoss];
                
                if (type === 'tributes') {
                    if (!checked) {
                        delete bossData.tributes[id];
                    }
                } else {
                    if (!checked) {
                        bossData[type] = bossData[type].filter(i => i !== id);
                    }
                }
            }
            
            // Update quantity
            function updateQuantity(id, quantity) {
                const bossData = app.editingRequirements[app.currentEditDiff][app.currentBoss];
                if (!bossData.tributes) bossData.tributes = {};
                bossData.tributes[id] = quantity;
            }
            
            // Remove item
            function removeItem(type, id) {
                const bossData = app.editingRequirements[app.currentEditDiff][app.currentBoss];
                
                if (type === 'tributes') {
                    delete bossData.tributes[id];
                } else {
                    bossData[type] = bossData[type].filter(i => i !== id);
                }
                
                loadRequirementsForBoss();
            }
            
            // Add new item
            function addNewItem(type) {
                const input = document.getElementById(`${type}AddInput`);
                const value = input.value.trim().toLowerCase().replace(/\s+/g, '-');
                
                if (!value) return;
                
                const bossData = app.editingRequirements[app.currentEditDiff][app.currentBoss];
                
                if (type === 'tributes') {
                    if (!bossData.tributes) bossData.tributes = {};
                    bossData.tributes[value] = 1;
                    app.itemNames.tributes[value] = input.value.trim();
                } else {
                    if (!bossData[type]) bossData[type] = [];
                    bossData[type].push(value);
                    app.itemNames[type][value] = input.value.trim();
                }
                
                input.value = '';
                loadRequirementsForBoss();
            }
            
            // Save requirements
            function saveRequirements() {
                app.bossRequirements = JSON.parse(JSON.stringify(app.editingRequirements));
                
                const settings = JSON.parse(localStorage.getItem('arkTrackerSettings') || '{}');
                settings.customRequirements = app.bossRequirements;
                localStorage.setItem('arkTrackerSettings', JSON.stringify(settings));
                
                alert('Requirements saved successfully!');
                renderBosses();
                document.getElementById('modalOverlay').classList.remove('active');
            }
            
            // Load inventory modal
            function loadInventoryModal() {
                console.log('Loading inventory modal...');
                
                // Load artifacts
                const artifactsList = document.getElementById('artifactsInventoryList');
                artifactsList.innerHTML = '';
                
                Object.entries(app.itemNames.artifacts).forEach(([id, name]) => {
                    const item = document.createElement('div');
                    item.className = 'inventory-item';
                    
                    const nameEl = document.createElement('div');
                    nameEl.className = 'inventory-item-name';
                    nameEl.textContent = name;
                    
                    const quantity = document.createElement('input');
                    quantity.type = 'number';
                    quantity.className = 'inventory-item-quantity';
                    quantity.id = `inv-artifact-${id}`;
                    quantity.value = (app.inventory.artifacts && app.inventory.artifacts[id]) || 0;
                    quantity.min = 0;
                    
                    item.appendChild(nameEl);
                    item.appendChild(quantity);
                    artifactsList.appendChild(item);
                });
                
                // Load tributes
                const tributesList = document.getElementById('tributesInventoryList');
                tributesList.innerHTML = '';
                
                Object.entries(app.itemNames.tributes).forEach(([id, name]) => {
                    const item = document.createElement('div');
                    item.className = 'inventory-item';
                    
                    const nameEl = document.createElement('div');
                    nameEl.className = 'inventory-item-name';
                    nameEl.textContent = name;
                    
                    const quantity = document.createElement('input');
                    quantity.type = 'number';
                    quantity.className = 'inventory-item-quantity';
                    quantity.id = `inv-tribute-${id}`;
                    quantity.value = (app.inventory.tributes && app.inventory.tributes[id]) || 0;
                    quantity.min = 0;
                    
                    item.appendChild(nameEl);
                    item.appendChild(quantity);
                    tributesList.appendChild(item);
                });
                
                // Load boss trophies
                const trophiesList = document.getElementById('trophiesInventoryList');
                trophiesList.innerHTML = '';
                
                Object.entries(app.itemNames.bossTrophies).forEach(([id, name]) => {
                    const item = document.createElement('div');
                    item.className = 'inventory-item';
                    
                    const nameEl = document.createElement('div');
                    nameEl.className = 'inventory-item-name';
                    nameEl.textContent = name;
                    
                    const quantity = document.createElement('input');
                    quantity.type = 'number';
                    quantity.className = 'inventory-item-quantity';
                    quantity.id = `inv-trophy-${id}`;
                    quantity.value = (app.inventory.bossTrophies && app.inventory.bossTrophies[id]) || 0;
                    quantity.min = 0;
                    
                    item.appendChild(nameEl);
                    item.appendChild(quantity);
                    trophiesList.appendChild(item);
                });
                
                updateInventorySummary();
            }
            
            // Save inventory - ROBUST VERSION
            function saveInventory() {
                console.log('Starting inventory save...');
                
                // Show saving state
                const saveBtn = document.getElementById('inventorySaveBtn');
                if (!saveBtn) {
                    console.error('Save button not found!');
                    return;
                }
                
                const originalText = saveBtn.textContent;
                saveBtn.textContent = 'Saving...';
                saveBtn.disabled = true;
                
                try {
                    // Create a clean inventory object
                    const inventoryToSave = {
                        artifacts: {},
                        tributes: {},
                        bossTrophies: {}
                    };
                    
                    // Save artifacts
                    Object.keys(app.itemNames.artifacts || {}).forEach(id => {
                        const input = document.getElementById(`inv-artifact-${id}`);
                        if (input) {
                            const value = parseInt(input.value) || 0;
                            if (value > 0) {
                                inventoryToSave.artifacts[id] = value;
                            }
                        }
                    });
                    
                    // Save tributes
                    Object.keys(app.itemNames.tributes || {}).forEach(id => {
                        const input = document.getElementById(`inv-tribute-${id}`);
                        if (input) {
                            const value = parseInt(input.value) || 0;
                            if (value > 0) {
                                inventoryToSave.tributes[id] = value;
                            }
                        }
                    });
                    
                    // Save boss trophies
                    Object.keys(app.itemNames.bossTrophies || {}).forEach(id => {
                        const input = document.getElementById(`inv-trophy-${id}`);
                        if (input) {
                            const value = parseInt(input.value) || 0;
                            if (value > 0) {
                                inventoryToSave.bossTrophies[id] = value;
                            }
                        }
                    });
                    
                    // Update app inventory
                    app.inventory = inventoryToSave;
                    
                    // Always save to localStorage first
                    localStorage.setItem('arkInventory', JSON.stringify(inventoryToSave));
                    console.log('Saved to localStorage:', inventoryToSave);
                    
                    // Check if we have a tribe name
                    const settings = JSON.parse(localStorage.getItem('arkTrackerSettings') || '{}');
                    
                    // Save to Firebase if connected and has tribe
                    if (app.useFirebase && app.inventoryRef && settings.tribeName) {
                        console.log('Firebase is enabled, attempting save...');
                        console.log('inventoryRef path:', app.inventoryRef.toString());
                        
                        app.inventoryRef.set(inventoryToSave)
                            .then(() => {
                                console.log('Firebase save successful!');
                                saveBtn.textContent = originalText;
                                saveBtn.disabled = false;
                                
                                updateInventoryCounter();
                                if (app.showInventory) {
                                    renderBosses();
                                }
                                
                                alert('‚úÖ Inventory saved to Firebase!');
                                document.getElementById('inventoryModalOverlay').classList.remove('active');
                            })
                            .catch((error) => {
                                console.error('Firebase save error:', error);
                                saveBtn.textContent = originalText;
                                saveBtn.disabled = false;
                                
                                if (error.code === 'PERMISSION_DENIED') {
                                    alert('‚ùå Permission Denied!\n\nCheck Firebase rules or try again.');
                                } else {
                                    alert(`‚ùå Firebase Error: ${error.message}\n\nSaved locally only.`);
                                }
                            });
                    } else {
                        // Local only
                        console.log('Saving locally only');
                        console.log('Tribe name:', settings.tribeName);
                        console.log('useFirebase:', app.useFirebase);
                        console.log('inventoryRef exists:', !!app.inventoryRef);
                        
                        saveBtn.textContent = originalText;
                        saveBtn.disabled = false;
                        
                        updateInventoryCounter();
                        if (app.showInventory) {
                            renderBosses();
                        }
                        
                        const message = !settings.tribeName ? 
                            '‚úÖ Inventory saved locally!\n\n‚ö†Ô∏è Set a Tribe Name in Settings to enable sync' :
                            '‚úÖ Inventory saved locally!';
                            
                        alert(message);
                        document.getElementById('inventoryModalOverlay').classList.remove('active');
                    }
                    
                } catch (error) {
                    console.error('Save inventory error:', error);
                    console.error('Error stack:', error.stack);
                    
                    if (saveBtn) {
                        saveBtn.textContent = originalText;
                        saveBtn.disabled = false;
                    }
                    
                    alert(`‚ùå Error: ${error.message}`);
                }
            }
            
            // Update inventory summary
            function updateInventorySummary() {
                const summaryContent = document.getElementById('inventorySummaryContent');
                summaryContent.innerHTML = '';
                
                // Count artifacts
                const artifactCount = Object.values(app.inventory.artifacts || {}).reduce((sum, qty) => sum + (parseInt(qty) || 0), 0);
                const artifactTypes = Object.keys(app.inventory.artifacts || {}).length;
                
                const artifactSummary = document.createElement('div');
                artifactSummary.className = 'inventory-summary-item';
                artifactSummary.innerHTML = `
                    <span>Artifacts</span>
                    <span>${artifactTypes} types (${artifactCount} total)</span>
                `;
                summaryContent.appendChild(artifactSummary);
                
                // Count tributes
                const tributeTypes = Object.keys(app.inventory.tributes || {}).length;
                const totalTributes = Object.values(app.inventory.tributes || {}).reduce((sum, qty) => sum + (parseInt(qty) || 0), 0);
                
                const tributeSummary = document.createElement('div');
                tributeSummary.className = 'inventory-summary-item';
                tributeSummary.innerHTML = `
                    <span>Tributes</span>
                    <span>${tributeTypes} types (${totalTributes} total)</span>
                `;
                summaryContent.appendChild(tributeSummary);
                
                // Count boss trophies
                const trophyCount = Object.values(app.inventory.bossTrophies || {}).reduce((sum, qty) => sum + (parseInt(qty) || 0), 0);
                const trophyTypes = Object.keys(app.inventory.bossTrophies || {}).length;
                
                const trophySummary = document.createElement('div');
                trophySummary.className = 'inventory-summary-item';
                trophySummary.innerHTML = `
                    <span>Boss Trophies</span>
                    <span>${trophyTypes} types (${trophyCount} total)</span>
                `;
                summaryContent.appendChild(trophySummary);
                
                // Add detailed list for items with quantities
                const detailsTitle = document.createElement('div');
                detailsTitle.style.marginTop = '20px';
                detailsTitle.style.fontSize = '14px';
                detailsTitle.style.color = '#888';
                detailsTitle.style.marginBottom = '10px';
                detailsTitle.textContent = 'Item Details:';
                summaryContent.appendChild(detailsTitle);
                
                // List all items with quantities
                const allItems = [
                    ...Object.entries(app.inventory.artifacts || {}).map(([id, qty]) => ({
                        name: app.itemNames.artifacts[id],
                        qty: parseInt(qty) || 0,
                        type: 'artifact'
                    })),
                    ...Object.entries(app.inventory.tributes || {}).map(([id, qty]) => ({
                        name: app.itemNames.tributes[id],
                        qty: parseInt(qty) || 0,
                        type: 'tribute'
                    })),
                    ...Object.entries(app.inventory.bossTrophies || {}).map(([id, qty]) => ({
                        name: app.itemNames.bossTrophies[id],
                        qty: parseInt(qty) || 0,
                        type: 'trophy'
                    }))
                ].filter(item => item.qty > 0).sort((a, b) => b.qty - a.qty);
                
                allItems.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'inventory-summary-item';
                    if (item.qty < 3) itemDiv.classList.add('low');
                    itemDiv.innerHTML = `
                        <span>${item.name}</span>
                        <span>√ó${item.qty}</span>
                    `;
                    summaryContent.appendChild(itemDiv);
                });
                
                if (allItems.length === 0) {
                    const emptyDiv = document.createElement('div');
                    emptyDiv.style.color = '#666';
                    emptyDiv.style.textAlign = 'center';
                    emptyDiv.style.marginTop = '20px';
                    emptyDiv.textContent = 'No items in inventory';
                    summaryContent.appendChild(emptyDiv);
                }
            }
            
            // Render boss cards
            function renderBosses() {
                const bossGrid = document.getElementById('bossGrid');
                bossGrid.innerHTML = '';
                
                ['broodmother', 'megapithecus', 'dragon', 'overseer'].forEach(bossId => {
                    const bossData = app.bossRequirements[app.currentDifficulty][bossId];
                    const bossCard = createBossCard(bossId, app.bossNames[bossId], bossData);
                    bossGrid.appendChild(bossCard);
                });
            }
            
            // Create boss card
            function createBossCard(bossId, bossName, bossData) {
                const card = document.createElement('div');
                card.className = 'boss-card';
                
                // Calculate progress
                const totalItems = (bossData.artifacts?.length || 0) + 
                                  Object.keys(bossData.tributes || {}).length + 
                                  (bossData.bossTrophies?.length || 0);
                let checkedCount = 0;
                
                // Count checked items
                bossData.artifacts?.forEach(item => {
                    if (app.checkedItems[`${app.currentDifficulty}-${bossId}-artifact-${item}`]) checkedCount++;
                });
                Object.keys(bossData.tributes || {}).forEach(item => {
                    if (app.checkedItems[`${app.currentDifficulty}-${bossId}-tribute-${item}`]) checkedCount++;
                });
                bossData.bossTrophies?.forEach(item => {
                    if (app.checkedItems[`${app.currentDifficulty}-${bossId}-trophy-${item}`]) checkedCount++;
                });
                
                const progress = totalItems > 0 ? (checkedCount / totalItems) * 100 : 0;
                if (progress === 100) {
                    card.classList.add('complete');
                }
                
                // Boss title
                const title = document.createElement('div');
                title.className = 'boss-title';
                
                const titleContent = document.createElement('div');
                titleContent.style.display = 'flex';
                titleContent.style.alignItems = 'center';
                
                const iconImg = document.createElement('img');
				iconImg.src = bossData.icon;
				iconImg.alt = bossName;
				iconImg.className = 'boss-icon';
				iconImg.onerror = function() {
					this.style.display = 'none';
					const fallback = document.createElement('span');
					fallback.style.fontSize = '28px';
					fallback.style.marginRight = '10px';
					fallback.textContent = app.bossEmojis[bossId];
					this.parentNode.insertBefore(fallback, this);
				};

				const nameSpan = document.createElement('span');
				nameSpan.className = 'boss-name';
				nameSpan.textContent = bossName;

				titleContent.appendChild(iconImg);  // Changed from iconSpan
				titleContent.appendChild(nameSpan);
                
                const badge = document.createElement('span');
                badge.className = 'complete-badge';
                badge.textContent = 'READY!';
                
                title.appendChild(titleContent);
                title.appendChild(badge);
                card.appendChild(title);
                
                // Progress bar
                const progressContainer = document.createElement('div');
                progressContainer.innerHTML = `
                    <div class="progress-text">${checkedCount} / ${totalItems} items collected</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progress}%"></div>
                    </div>
                `;
                card.appendChild(progressContainer);
                
                // Requirements sections
                if (bossData.artifacts?.length > 0) {
                    const section = createRequirementsSection2('Artifacts', bossData.artifacts, bossId, 'artifact');
                    card.appendChild(section);
                }
                
                if (Object.keys(bossData.tributes || {}).length > 0) {
                    const section = createTributesSection(bossData.tributes, bossId);
                    card.appendChild(section);
                }
                
                if (bossData.bossTrophies?.length > 0) {
                    const section = createRequirementsSection2('Boss Trophies', bossData.bossTrophies, bossId, 'trophy');
                    card.appendChild(section);
                }
                
                return card;
            }
            
            // Create requirements section for card
            function createRequirementsSection2(title, items, bossId, type) {
                const section = document.createElement('div');
                section.className = 'requirements-section';
                
                const sectionTitle = document.createElement('div');
                sectionTitle.className = 'section-title';
                sectionTitle.textContent = title;
                section.appendChild(sectionTitle);
                
                items.forEach(item => {
                    const itemKey = `${app.currentDifficulty}-${bossId}-${type}-${item}`;
                    const isChecked = app.checkedItems[itemKey];
                    
                    const itemEl = document.createElement('div');
                    itemEl.className = 'requirement-item' + (isChecked ? ' checked' : '');
                    itemEl.onclick = () => toggleCheckedItem(itemKey);
                    
                    const checkbox = document.createElement('div');
                    checkbox.className = 'checkbox';
                    
                    const name = document.createElement('span');
                    name.className = 'requirement-name';
                    name.textContent = app.itemNames[type === 'artifact' ? 'artifacts' : 'bossTrophies'][item] || item;
                    
                    itemEl.appendChild(checkbox);
                    itemEl.appendChild(name);
                    
                    // Add inventory badge if enabled
                    if (app.showInventory) {
                        const inventoryType = type === 'artifact' ? 'artifacts' : 'bossTrophies';
                        const invQty = parseInt(app.inventory[inventoryType][item]) || 0;
                        if (invQty > 0) {
                            const badge = document.createElement('span');
                            badge.className = 'inventory-badge';
                            
                            const distributed = calculateDistributedItems();
                            const alreadyDistributed = distributed[inventoryType][item] || 0;
                            
                            badge.textContent = `Stock: ${invQty}`;
                            if (invQty <= alreadyDistributed && !isChecked) {
                                badge.classList.add('danger');
                                badge.textContent = `Stock: ${invQty} (all used)`;
                            } else if (invQty < alreadyDistributed + 1) {
                                badge.classList.add('warning');
                            }
                            itemEl.appendChild(badge);
                        }
                    }
                    
                    section.appendChild(itemEl);
                });
                
                return section;
            }
            
            // Create tributes section
            function createTributesSection(tributes, bossId) {
                const section = document.createElement('div');
                section.className = 'requirements-section';
                
                const sectionTitle = document.createElement('div');
                sectionTitle.className = 'section-title';
                sectionTitle.textContent = 'Tributes';
                section.appendChild(sectionTitle);
                
                Object.entries(tributes).forEach(([item, quantity]) => {
                    const itemKey = `${app.currentDifficulty}-${bossId}-tribute-${item}`;
                    const isChecked = app.checkedItems[itemKey];
                    
                    const itemEl = document.createElement('div');
                    itemEl.className = 'requirement-item' + (isChecked ? ' checked' : '');
                    itemEl.onclick = () => toggleCheckedItem(itemKey);
                    
                    const checkbox = document.createElement('div');
                    checkbox.className = 'checkbox';
                    
                    const name = document.createElement('span');
                    name.className = 'requirement-name';
                    name.textContent = app.itemNames.tributes[item] || item;
                    
                    itemEl.appendChild(checkbox);
                    itemEl.appendChild(name);
                    
                    if (quantity > 1) {
                        const qty = document.createElement('span');
                        qty.className = 'requirement-quantity';
                        qty.textContent = `√ó${quantity}`;
                        itemEl.appendChild(qty);
                    }
                    
                    // Add inventory badge if enabled
                    if (app.showInventory) {
                        const invQty = parseInt(app.inventory.tributes[item]) || 0;
                        if (invQty > 0) {
                            const badge = document.createElement('span');
                            badge.className = 'inventory-badge';
                            badge.textContent = `Stock: ${invQty}`;
                            
                            // Calculate total needed across all difficulties/bosses
                            const distributed = calculateDistributedItems();
                            const alreadyDistributed = distributed.tributes[item] || 0;
                            
                            if (invQty < quantity) {
                                badge.classList.add('danger');
                            } else if (invQty < alreadyDistributed + quantity && !isChecked) {
                                badge.classList.add('warning');
                                badge.textContent = `Stock: ${invQty} (${alreadyDistributed} allocated)`;
                            }
                            itemEl.appendChild(badge);
                        }
                    }
                    
                    section.appendChild(itemEl);
                });
                
                return section;
            }
            
            // Toggle checked item
            function toggleCheckedItem(itemKey) {
                const newValue = !app.checkedItems[itemKey];
                
                // If checking the item, verify inventory availability
                if (newValue && app.showInventory) {
                    const parts = itemKey.split('-');
                    const difficulty = parts[0];
                    const bossId = parts[1];
                    const type = parts[2];
                    const itemId = parts.slice(3).join('-');
                    
                    const distributed = calculateDistributedItems();
                    
                    if (type === 'artifact') {
                        const inInventory = parseInt(app.inventory.artifacts[itemId]) || 0;
                        const alreadyDistributed = distributed.artifacts[itemId] || 0;
                        
                        if (inInventory === 0) {
                            alert('This artifact is not in your inventory!');
                            return;
                        }
                        if (inInventory <= alreadyDistributed && !app.checkedItems[itemKey]) {
                            alert(`Not enough ${app.itemNames.artifacts[itemId]} in inventory!\nIn stock: ${inInventory}\nAlready distributed: ${alreadyDistributed}`);
                            return;
                        }
                    } else if (type === 'tribute') {
                        const inInventory = parseInt(app.inventory.tributes[itemId]) || 0;
                        const alreadyDistributed = distributed.tributes[itemId] || 0;
                        const bossData = app.bossRequirements[difficulty][bossId];
                        const required = bossData.tributes[itemId] || 0;
                        
                        // Calculate how much would be distributed after this action
                        const wouldBeDistributed = alreadyDistributed + required - (app.checkedItems[itemKey] ? required : 0);
                        
                        if (wouldBeDistributed > inInventory) {
                            alert(`Not enough ${app.itemNames.tributes[itemId]} in inventory!\nIn stock: ${inInventory}\nWould need: ${wouldBeDistributed}`);
                            return;
                        }
                    } else if (type === 'trophy') {
                        const inInventory = parseInt(app.inventory.bossTrophies[itemId]) || 0;
                        const alreadyDistributed = distributed.bossTrophies[itemId] || 0;
                        
                        if (inInventory === 0) {
                            alert('This boss trophy is not in your inventory!');
                            return;
                        }
                        if (inInventory <= alreadyDistributed && !app.checkedItems[itemKey]) {
                            alert(`Not enough ${app.itemNames.bossTrophies[itemId]} in inventory!\nIn stock: ${inInventory}\nAlready distributed: ${alreadyDistributed}`);
                            return;
                        }
                    }
                }
                
                if (app.useFirebase && app.dataRef) {
                    app.dataRef.child(itemKey).set(newValue || null);
                } else {
                    if (newValue) {
                        app.checkedItems[itemKey] = true;
                    } else {
                        delete app.checkedItems[itemKey];
                    }
                    localStorage.setItem('arkBossTracker', JSON.stringify(app.checkedItems));
                    renderBosses();
                }
            }
            
            // Start the app
            init();
        });
    </script>
</body>
</html>